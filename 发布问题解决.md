# npm 发布问题解决

## 问题1: 包名冲突 ✅ 已解决

- ❌ `yapi-mcp-server` 已被占用
- ✅ 已改为 `@neigri/yapi-mcp-server`

## 问题2: Token 过期 ⚠️ 需要处理

错误信息显示：`Access token expired or revoked`

需要重新生成并配置 token。

## 解决步骤

### 步骤1: 生成新的 Access Token

1. 访问：https://www.npmjs.com/settings/neigri/tokens
2. 点击 **"Generate New Token"**
3. 选择 **"Granular"** 类型
4. 设置权限：
   - ✅ **Bypass 2FA**（必须）
   - ✅ **Publish** 权限
   - ✅ Packages: `@neigri/*` 或 "All packages"
5. 复制生成的 token

### 步骤2: 配置新 Token

```bash
# 删除旧 token
npm config delete //registry.npmjs.org/:_authToken

# 配置新 token
npm config set //registry.npmjs.org/:_authToken=你的新token

# 验证
npm whoami
```

### 步骤3: 发布

```bash
cd /Users/makeblock/Desktop/plugin/yapi-mcp-server
npm publish --access public
```

**注意**：使用 scope 包名（`@neigri/...`）时，需要添加 `--access public` 参数。

## 快速命令

```bash
# 1. 配置新 token
npm config set //registry.npmjs.org/:_authToken=你的新token

# 2. 验证
npm whoami

# 3. 发布
npm publish --access public
```

## 使用新包名

发布后，使用方式：

```bash
# 安装
npm install -g @neigri/yapi-mcp-server

# 或使用 npx
npx @neigri/yapi-mcp-server
```

## 在 Cursor/Claude Desktop 中使用

```json
{
  "mcpServers": {
    "yapi-mcp-server": {
      "command": "npx",
      "args": ["-y", "@neigri/yapi-mcp-server@latest"],
      "env": {
        "YAPI_BASE_URL": "https://yapi.makeblock.com",
        "YAPI_TOKEN": "your-token"
      }
    }
  }
}
```

